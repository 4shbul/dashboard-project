<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskFlow Studio - Dashboard Kreatif</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Sora:wght@600;700&display=swap");

    :root {
      --bg: #f4f7fb;
      --surface: #ffffff;
      --surface-soft: #f8fbff;
      --text: #15213a;
      --muted: #5f6f86;
      --line: #dde6f3;
      --primary: #1f6fff;
      --primary-soft: #e9f0ff;
      --mint: #10b981;
      --danger: #d4385a;
      --todo: #6d7d94;
      --progress: #1f6fff;
      --review: #ad6d00;
      --done: #0f7a53;
      --radius-lg: 20px;
      --radius-md: 14px;
      --radius-sm: 10px;
      --shadow: 0 8px 24px rgba(17, 33, 62, 0.08);
      --shadow-lg: 0 18px 42px rgba(17, 33, 62, 0.12);
      --ease: cubic-bezier(0.22, 1, 0.36, 1);
      --dur-fast: 0.2s;
      --dur-mid: 0.35s;
    }

    * { box-sizing: border-box; }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      color: var(--text);
      font-family: "Plus Jakarta Sans", "Segoe UI", sans-serif;
      background:
        radial-gradient(800px 260px at 0% -10%, #dbe9ff 0%, transparent 65%),
        radial-gradient(600px 220px at 100% 0%, #d4f5ea 0%, transparent 62%),
        var(--bg);
      min-height: 100vh;
      padding: 24px 0 30px;
      animation: pageFade 0.55s var(--ease) both;
    }

    .shell {
      width: min(1560px, 96vw);
      margin: 0 auto;
    }

    .auth-app {
      width: min(980px, 94vw);
      margin: 14px auto 0;
      display: grid;
      grid-template-columns: 1.05fr 1fr;
      gap: 14px;
      align-items: stretch;
      animation: liftIn 0.55s var(--ease) both;
    }

    .auth-brand {
      position: relative;
      overflow: hidden;
      padding: 20px;
      border-radius: var(--radius-lg);
      border: 1px solid #2d5fa1;
      background: linear-gradient(130deg, #10284e 0%, #173c72 55%, #2362b1 100%);
      background-size: 160% 160%;
      box-shadow: var(--shadow-lg);
      color: #eff6ff;
      animation: gradientFlow 11s ease-in-out infinite, liftIn 0.55s var(--ease) both;
    }

    .auth-brand::before,
    .auth-brand::after {
      content: "";
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
    }

    .auth-brand::before {
      width: 210px;
      height: 210px;
      right: -70px;
      top: -90px;
      background: radial-gradient(circle, rgba(98, 170, 255, 0.33), transparent 70%);
      animation: floatBlob 6.8s ease-in-out infinite;
    }

    .auth-brand::after {
      width: 190px;
      height: 190px;
      left: -70px;
      bottom: -95px;
      background: radial-gradient(circle, rgba(51, 222, 174, 0.26), transparent 70%);
      animation: floatBlob 7.2s ease-in-out infinite reverse;
    }

    .auth-brand > * {
      position: relative;
      z-index: 1;
    }

    .auth-brand h2 {
      margin: 0;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-size: clamp(1.3rem, 2.4vw, 1.9rem);
      line-height: 1.2;
    }

    .auth-brand p {
      margin: 10px 0 0;
      color: #d3e2fb;
      font-size: 0.93rem;
      line-height: 1.5;
    }

    .auth-card {
      position: relative;
      overflow: hidden;
      isolation: isolate;
      padding: 16px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--line);
      background: var(--surface);
      box-shadow: var(--shadow);
      animation: liftIn 0.55s var(--ease) both;
      animation-delay: 0.08s;
    }

    .auth-card::before {
      content: "";
      position: absolute;
      inset: -2px;
      z-index: -1;
      background: conic-gradient(from 120deg, rgba(31, 111, 255, 0.14), rgba(16, 185, 129, 0.06), rgba(31, 111, 255, 0.14));
      filter: blur(30px);
      animation: tabGlow 8s linear infinite;
    }

    .auth-tabs {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      padding: 4px;
      border-radius: 12px;
      background: #eef4ff;
      margin-bottom: 10px;
    }

    .auth-tabs::before {
      content: "";
      position: absolute;
      top: 4px;
      bottom: 4px;
      left: 4px;
      width: calc(50% - 6px);
      border-radius: 9px;
      background: #ffffff;
      box-shadow: 0 8px 16px rgba(20, 41, 78, 0.08);
      transition: transform var(--dur-mid) var(--ease);
      z-index: 0;
    }

    .auth-card[data-mode="signup"] .auth-tabs::before {
      transform: translateX(calc(100% + 4px));
    }

    .auth-tab {
      border: 0;
      background: transparent;
      color: #385179;
      font-weight: 700;
      border-radius: 10px;
      padding: 9px;
      cursor: pointer;
      transition: transform var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease), background var(--dur-mid) var(--ease), color var(--dur-mid) var(--ease);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .auth-tab:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(25, 47, 84, 0.1);
    }

    .auth-tab.active {
      color: #1f4e9b;
      background: transparent;
    }

    .auth-form {
      display: grid;
      gap: 8px;
      transform-origin: top center;
    }

    .auth-form.reveal {
      animation: formReveal 0.45s var(--ease) both;
    }

    .auth-form.shake {
      animation: shakeX 0.38s ease;
    }

    .auth-form h3 {
      margin: 0 0 2px;
      font-size: 0.94rem;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
    }

    .auth-msg {
      margin-top: 8px;
      min-height: 18px;
      font-size: 0.8rem;
      color: #3f567a;
      transition: color var(--dur-fast) var(--ease), opacity var(--dur-fast) var(--ease), transform var(--dur-fast) var(--ease);
    }

    .auth-msg.success {
      color: var(--done);
    }

    .auth-msg.error {
      color: var(--danger);
    }

    .chip-logout {
      margin-top: 7px;
      width: auto;
      padding: 6px 9px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.32);
      background: rgba(255, 255, 255, 0.12);
      color: #f0f6ff;
      font-size: 0.74rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--dur-fast) var(--ease), background var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease);
      position: relative;
      overflow: hidden;
    }

    .chip-logout:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 15px rgba(3, 16, 37, 0.2);
    }

    .hero {
      display: grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 14px;
      padding: 18px;
      border-radius: var(--radius-lg);
      background: linear-gradient(130deg, #10284e 0%, #173c72 55%, #2362b1 100%);
      background-size: 140% 140%;
      border: 1px solid #2d5fa1;
      color: #f0f6ff;
      box-shadow: var(--shadow-lg);
      animation: gradientFlow 12s ease-in-out infinite, liftIn 0.6s var(--ease) both;
    }

    .eyebrow {
      display: inline-flex;
      margin-bottom: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.12);
      font-size: 0.67rem;
      font-weight: 700;
      letter-spacing: 0.9px;
      color: #d8e8ff;
    }

    .hero h1 {
      margin: 0;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-size: clamp(1.45rem, 2.4vw, 2.05rem);
      line-height: 1.2;
      letter-spacing: 0.2px;
    }

    .hero p {
      margin: 8px 0 0;
      color: #d3e2fb;
      font-size: 0.95rem;
      line-height: 1.55;
      max-width: 760px;
    }

    .hero-right {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 9px;
      align-content: start;
    }

    .hero-chip {
      padding: 10px 11px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: rgba(255, 255, 255, 0.11);
      backdrop-filter: blur(4px);
      font-size: 0.84rem;
      line-height: 1.48;
      transition: transform var(--dur-mid) var(--ease), background var(--dur-mid) var(--ease), border-color var(--dur-mid) var(--ease);
      animation: liftIn 0.55s var(--ease) both;
    }

    .hero-chip:nth-child(1) { animation-delay: 0.08s; }
    .hero-chip:nth-child(2) { animation-delay: 0.14s; }
    .hero-chip:nth-child(3) { animation-delay: 0.2s; }
    .hero-chip:nth-child(4) { animation-delay: 0.26s; }
    .hero-chip:nth-child(5) { animation-delay: 0.32s; }

    .hero-chip:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(255, 255, 255, 0.32);
    }

    .glass {
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      transition: transform var(--dur-mid) var(--ease), box-shadow var(--dur-mid) var(--ease);
    }

    .glass:hover {
      transform: translateY(-1px);
      box-shadow: 0 13px 27px rgba(17, 33, 62, 0.11);
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 11px;
      margin: 14px 0;
    }

    .kpi {
      padding: 14px;
      border-top: 3px solid #d8e7ff;
      animation: liftIn 0.45s var(--ease) both;
    }

    .kpi:nth-child(1) { border-top-color: #96b8ff; animation-delay: 0.03s; }
    .kpi:nth-child(2) { border-top-color: #73dcb6; animation-delay: 0.06s; }
    .kpi:nth-child(3) { border-top-color: #9fb9ff; animation-delay: 0.09s; }
    .kpi:nth-child(4) { border-top-color: #ffd08b; animation-delay: 0.12s; }
    .kpi:nth-child(5) { border-top-color: #a3d6ff; animation-delay: 0.15s; }
    .kpi:nth-child(6) { border-top-color: #8ce1c5; animation-delay: 0.18s; }

    .kpi h3 {
      margin: 0;
      font-size: 0.74rem;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.55px;
    }

    .kpi .v {
      margin-top: 7px;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-size: clamp(1.12rem, 1.8vw, 1.52rem);
      font-weight: 700;
      color: #102954;
    }

    .workspace {
      display: grid;
      grid-template-columns: minmax(320px, 360px) minmax(0, 1fr);
      gap: 14px;
      align-items: start;
    }

    .side,
    .main { padding: 16px; }

    .side {
      position: sticky;
      top: 16px;
      max-height: calc(100vh - 32px);
      overflow: auto;
    }

    .side::-webkit-scrollbar { width: 8px; }
    .side::-webkit-scrollbar-thumb {
      background: #d2deef;
      border-radius: 999px;
    }

    .block {
      background: linear-gradient(180deg, #ffffff 0%, var(--surface-soft) 100%);
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      padding: 13px;
      margin-bottom: 10px;
      animation: liftIn 0.45s var(--ease) both;
    }

    .side .block:nth-child(1) { animation-delay: 0.03s; }
    .side .block:nth-child(2) { animation-delay: 0.08s; }
    .side .block:nth-child(3) { animation-delay: 0.13s; }
    .side .block:nth-child(4) { animation-delay: 0.18s; }
    .main .toolbar { animation: liftIn 0.42s var(--ease) both; animation-delay: 0.05s; }
    .main .insight-grid { animation: liftIn 0.45s var(--ease) both; animation-delay: 0.1s; }
    .main .task-area { animation: liftIn 0.48s var(--ease) both; animation-delay: 0.15s; }

    .hidden {
      display: none !important;
    }

    .block h2,
    .block h3 {
      margin: 0 0 8px;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-size: 0.98rem;
      letter-spacing: 0.2px;
    }

    .profile-head {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .profile-avatar {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-weight: 700;
      color: #12489f;
      background: linear-gradient(140deg, #e8f1ff 0%, #d8ecff 100%);
      border: 1px solid #c8dbff;
    }

    .profile-name {
      margin: 0;
      font-size: 0.9rem;
      color: #1d355c;
      font-weight: 700;
      line-height: 1.2;
    }

    .profile-role {
      margin: 2px 0 0;
      font-size: 0.74rem;
      color: #5c6f8d;
      line-height: 1.3;
    }

    .f { display: grid; gap: 8px; }

    label {
      font-size: 0.79rem;
      font-weight: 600;
      color: var(--muted);
    }

    input,
    select,
    textarea,
    button {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 1px solid #d8e3f4;
      background: #fff;
      padding: 10px 11px;
      color: #122751;
      font: inherit;
      transition: border-color var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease), transform var(--dur-fast) var(--ease), background var(--dur-fast) var(--ease);
    }

    input:hover,
    select:hover,
    textarea:hover {
      border-color: #bfd2f3;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #8fb5ff;
      box-shadow: 0 0 0 3px rgba(31, 111, 255, 0.14);
    }

    textarea { min-height: 82px; resize: vertical; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .btn-row { display: flex; gap: 8px; }
    .btn-row > * { flex: 1; }

    .btn {
      border: 0;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease), filter var(--dur-fast) var(--ease);
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(20, 41, 78, 0.12);
      filter: saturate(1.05);
    }

    .btn.primary {
      color: #fff;
      background: linear-gradient(120deg, var(--primary) 0%, #36a2ff 100%);
    }

    .btn.soft {
      color: #2d466d;
      background: var(--primary-soft);
      border: 1px solid #d4e4ff;
    }

    .btn.wa {
      color: #fff;
      background: linear-gradient(120deg, #14ab78 0%, #1ec38f 100%);
    }

    .btn.danger {
      color: #a42240;
      background: #ffe9ee;
      border: 1px solid #f5cbd6;
    }

    .progress-wrap { margin-top: 2px; }

    .progress-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.81rem;
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 6px;
    }

    .bar {
      height: 12px;
      border-radius: 999px;
      background: #e2ebf8;
      overflow: hidden;
    }

    .bar > span {
      display: block;
      width: 0;
      height: 100%;
      background: linear-gradient(120deg, var(--primary) 0%, var(--mint) 100%);
      transition: width 0.3s ease;
    }

    .meta,
    .hint {
      color: var(--muted);
      font-size: 0.8rem;
      line-height: 1.45;
    }

    .preview {
      margin-top: 8px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--line);
      background: #fff;
      padding: 9px;
      min-height: 90px;
      max-height: 160px;
      overflow: auto;
      white-space: pre-wrap;
      font-size: 0.77rem;
      line-height: 1.4;
      animation: fadeIn 0.5s var(--ease) both;
    }

    .ig-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .ig-timeline {
      margin-top: 8px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--line);
      background: #fff;
      overflow: hidden;
    }

    .ig-row {
      display: grid;
      grid-template-columns: 72px 1fr;
      align-items: center;
      gap: 8px;
      padding: 8px 9px;
      border-bottom: 1px solid #edf2fb;
      animation: fadeSlideUp 0.4s var(--ease) both;
    }

    .ig-row:last-child {
      border-bottom: 0;
    }

    .ig-day {
      font-size: 0.74rem;
      font-weight: 700;
      color: #4e6384;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .ig-slot-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .ig-slot {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 0.73rem;
      font-weight: 700;
      border: 1px solid #d8e6ff;
      background: #ebf2ff;
      color: #1f56b8;
    }

    .ig-slot.secondary {
      border-color: #d4efe5;
      background: #e8faf3;
      color: #0f7956;
    }

    .ig-badge {
      font-size: 0.66rem;
      border-radius: 6px;
      padding: 3px 6px;
      font-weight: 700;
      color: #5f6f86;
      background: #eef3fa;
      border: 1px solid #dde6f4;
    }

    .ig-top {
      margin-top: 8px;
      padding: 8px;
      border-radius: var(--radius-sm);
      border: 1px dashed #cfe0ff;
      background: #f7fbff;
      font-size: 0.76rem;
      color: #3e577c;
      line-height: 1.45;
      white-space: pre-line;
    }

    .ig-live-card {
      margin-top: 8px;
      padding: 9px;
      border-radius: var(--radius-sm);
      border: 1px solid #d8e6ff;
      background: linear-gradient(120deg, #f5f9ff 0%, #eef7ff 100%);
      animation: fadeIn 0.45s var(--ease) both;
    }

    .ig-live-title {
      font-size: 0.75rem;
      font-weight: 700;
      color: #4e6384;
      text-transform: uppercase;
      letter-spacing: 0.45px;
    }

    .ig-live-countdown {
      margin-top: 4px;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-size: 1.05rem;
      color: #12326a;
      letter-spacing: 0.2px;
    }

    .ig-live-meta {
      margin-top: 3px;
      font-size: 0.76rem;
      color: #3f567a;
      line-height: 1.4;
    }

    .ig-consistency {
      margin-top: 8px;
      font-size: 0.76rem;
      color: #3f567a;
      line-height: 1.42;
      border-left: 3px solid #cde1ff;
      padding-left: 8px;
    }

    .ig-row.today {
      background: #f8fbff;
    }

    .ig-slot.now {
      border-color: #9fdac5;
      background: #e8faf3;
      color: #0f7a55;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.13);
      animation: pulseNow 1.8s ease-in-out infinite;
    }

    .ig-slot.next {
      border-color: #b5d0ff;
      background: #eaf2ff;
      color: #1b53b1;
      box-shadow: 0 0 0 3px rgba(31, 111, 255, 0.12);
    }

    .ig-slot.missed {
      border-color: #efd6dc;
      background: #fff5f7;
      color: #ab3554;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 11px;
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      background: #f8fbff;
    }

    .toolbar > input {
      flex: 2 1 360px;
      min-width: 280px;
    }

    .toolbar > select {
      flex: 1 1 170px;
      min-width: 160px;
    }

    .view-switch {
      display: flex;
      gap: 6px;
      margin-left: auto;
    }

    .view-switch button {
      width: auto;
      padding: 9px 11px;
      border-radius: 9px;
      border: 1px solid var(--line);
      background: #fff;
      color: #385179;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease), background var(--dur-mid) var(--ease), color var(--dur-mid) var(--ease);
      position: relative;
      overflow: hidden;
    }

    .view-switch button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(20, 41, 78, 0.1);
    }

    .view-switch button.active {
      color: #fff;
      background: linear-gradient(120deg, var(--primary) 0%, #36a2ff 100%);
      border-color: transparent;
    }

    .insight-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(220px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .insight {
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
      padding: 10px;
      transition: transform var(--dur-mid) var(--ease), box-shadow var(--dur-mid) var(--ease);
    }

    .insight:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 20px rgba(16, 39, 74, 0.1);
    }

    .insight h3 {
      margin: 0 0 8px;
      font-size: 0.82rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .ring {
      --pct: 0%;
      width: 106px;
      aspect-ratio: 1;
      margin: 4px auto 2px;
      display: grid;
      place-items: center;
      border-radius: 50%;
      font-family: "Sora", "Plus Jakarta Sans", sans-serif;
      font-weight: 700;
      color: #1a4089;
      background:
        radial-gradient(closest-side, #fff 74%, transparent 75% 100%),
        conic-gradient(var(--primary) var(--pct), #dce9ff 0);
      transition: transform var(--dur-mid) var(--ease), background var(--dur-mid) var(--ease);
      animation: pulseRing 3.4s ease-in-out infinite;
    }

    .mini-line {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
      font-size: 0.81rem;
      color: #3f567a;
      font-weight: 600;
    }

    .task-area {
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      overflow: hidden;
      background: #fff;
    }

    .table-wrap { overflow: auto; }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 980px;
    }

    th,
    td {
      border-bottom: 1px solid #e8f0fb;
      padding: 11px 10px;
      text-align: left;
      vertical-align: top;
      font-size: 0.88rem;
      transition: background var(--dur-fast) var(--ease);
    }

    tbody tr:hover td {
      background: #f8fbff;
    }

    th {
      position: sticky;
      top: 0;
      z-index: 2;
      background: #f6faff;
      color: #4f6182;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      font-size: 0.74rem;
    }

    .pill {
      display: inline-block;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 0.74rem;
      font-weight: 700;
    }

    .p-web { background: #e5eeff; color: #2d58bf; }
    .p-design { background: #ffebd8; color: #9f5b00; }
    .prio-high { background: #ffe1e9; color: #a52443; }
    .prio-medium { background: #fff3db; color: #986000; }
    .prio-low { background: #dcf8ec; color: #0e7f50; }

    .status {
      display: inline-block;
      min-width: 94px;
      text-align: center;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .s-todo { color: var(--todo); background: #ecf1f8; }
    .s-progress { color: var(--progress); background: #dfebff; }
    .s-review { color: var(--review); background: #fcefd1; }
    .s-done { color: var(--done); background: #daf6ea; }

    .action-row {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .mini {
      width: auto;
      border-radius: 8px;
      padding: 6px 8px;
      border: 1px solid var(--line);
      background: #fff;
      color: #364d74;
      font-size: 0.72rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--dur-fast) var(--ease), background var(--dur-fast) var(--ease), box-shadow var(--dur-fast) var(--ease);
      position: relative;
      overflow: hidden;
    }

    .mini:hover {
      background: #f2f7ff;
      transform: translateY(-1px);
      box-shadow: 0 8px 14px rgba(20, 41, 78, 0.1);
    }

    .mini.d {
      color: #9d1f3b;
      border-color: #f1ced7;
      background: #fff6f8;
    }

    .kanban {
      display: grid;
      grid-template-columns: repeat(4, minmax(230px, 1fr));
      gap: 9px;
      padding: 11px;
      min-height: 340px;
      overflow: auto;
      background: #fbfdff;
    }

    .lane {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fff;
      padding: 8px;
      transition: transform var(--dur-mid) var(--ease), box-shadow var(--dur-mid) var(--ease);
    }

    .lane:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 18px rgba(20, 41, 78, 0.09);
    }

    .lane h4 {
      margin: 0 0 8px;
      padding-bottom: 7px;
      border-bottom: 1px solid #ecf2fb;
      font-size: 0.82rem;
      color: #3b547f;
    }

    .task-card {
      border: 1px solid #e6eef9;
      border-radius: 10px;
      background: #fff;
      padding: 8px;
      margin-bottom: 7px;
      transition: transform var(--dur-mid) var(--ease), box-shadow var(--dur-mid) var(--ease), border-color var(--dur-fast) var(--ease);
    }

    .task-card:hover {
      transform: translateY(-2px);
      border-color: #cadeff;
      box-shadow: 0 10px 18px rgba(20, 41, 78, 0.08);
    }

    .task-card b { font-size: 0.84rem; }

    .task-meta {
      margin-top: 5px;
      color: #5b6f8f;
      font-size: 0.74rem;
      line-height: 1.35;
    }

    .empty {
      padding: 30px 12px;
      text-align: center;
      color: #607293;
      font-size: 0.9rem;
      animation: fadeIn 0.35s var(--ease) both;
    }

    .small { font-size: 0.75rem; }

    .row-enter {
      opacity: 0;
      animation: fadeSlideUp 0.45s var(--ease) forwards;
    }

    .lane-enter {
      opacity: 0;
      animation: fadeSlideUp 0.5s var(--ease) forwards;
    }

    .card-enter {
      opacity: 0;
      animation: fadeSlideUp 0.4s var(--ease) forwards;
    }

    .btn-ripple {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      pointer-events: none;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.45);
      animation: ripple 0.65s ease-out forwards;
    }

    @keyframes pageFade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes liftIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeSlideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes formReveal {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes shakeX {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes floatBlob {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-10px) scale(1.04); }
    }

    @keyframes tabGlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulseRing {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    @keyframes pulseNow {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.04); }
    }

    @keyframes ripple {
      from {
        opacity: 0.7;
        width: 8px;
        height: 8px;
      }
      to {
        opacity: 0;
        width: 180px;
        height: 180px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation: none !important;
        transition: none !important;
      }
    }

    @media (max-width: 1450px) {
      .kpi-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
      .workspace { grid-template-columns: minmax(300px, 335px) minmax(0, 1fr); }
    }

    @media (max-width: 1260px) {
      .auth-app {
        grid-template-columns: 1fr;
      }

      .hero { grid-template-columns: 1fr; }
      .workspace { grid-template-columns: 1fr; }
      .side {
        position: static;
        max-height: none;
        overflow: visible;
      }
      .view-switch { margin-left: 0; }
    }

    @media (max-width: 980px) {
      .kpi-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .hero-right { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 760px) {
      body { padding-top: 14px; }
      .shell { width: min(100%, 95vw); }
      .hero-right { grid-template-columns: 1fr; }
      .ig-grid { grid-template-columns: 1fr; }
      .ig-row { grid-template-columns: 1fr; gap: 6px; }
      .toolbar > input,
      .toolbar > select {
        min-width: 100%;
        flex: 1 1 100%;
      }
      .view-switch { width: 100%; }
      .view-switch button { flex: 1; }
      .insight-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="auth-app" id="authApp">
    <section class="auth-brand">
      <span class="eyebrow">TEAM ACCESS</span>
      <h2>TaskFlow Studio</h2>
      <p>Sistem manajemen tugas kolaboratif untuk semua karyawan. Setiap akun punya data tugas masing-masing.</p>
    </section>

    <section class="auth-card" id="authCard" data-mode="login">
      <div class="auth-tabs">
        <button type="button" class="auth-tab active" id="showLoginTab">Login</button>
        <button type="button" class="auth-tab" id="showSignupTab">Sign Up</button>
      </div>

      <form id="loginForm" class="auth-form">
        <h3>Masuk Akun</h3>
        <div>
          <label for="loginEmail">Email</label>
          <input id="loginEmail" type="email" placeholder="karyawan@perusahaan.com" required>
        </div>
        <div>
          <label for="loginPassword">Password</label>
          <input id="loginPassword" type="password" minlength="6" placeholder="Minimal 6 karakter" required>
        </div>
        <button class="btn primary" type="submit">Login</button>
      </form>

      <form id="signupForm" class="auth-form hidden">
        <h3>Buat Akun Karyawan</h3>
        <div>
          <label for="signupName">Nama Lengkap</label>
          <input id="signupName" placeholder="Contoh: Budi Santoso" required>
        </div>
        <div>
          <label for="signupEmail">Email</label>
          <input id="signupEmail" type="email" placeholder="karyawan@perusahaan.com" required>
        </div>
        <div>
          <label for="signupPassword">Password</label>
          <input id="signupPassword" type="password" minlength="6" placeholder="Minimal 6 karakter" required>
        </div>
        <div>
          <label for="signupPasswordConfirm">Konfirmasi Password</label>
          <input id="signupPasswordConfirm" type="password" minlength="6" required>
        </div>
        <button class="btn primary" type="submit">Buat Akun</button>
      </form>

      <div id="authMessage" class="auth-msg"></div>
    </section>
  </div>

  <div class="shell hidden" id="dashboardApp">
    <header class="hero">
      <div>
        <span class="eyebrow">CREATIVE OPS</span>
        <h1>TaskFlow Studio</h1>
        <p>Workspace modern untuk mengelola pekerjaan Web Developer dan Graphic Designer dengan insight real-time, Kanban, dan laporan WhatsApp.</p>
      </div>
      <div class="hero-right">
        <div class="hero-chip"><b>Waktu Saat Ini</b><br><span id="clock">-</span></div>
        <div class="hero-chip"><b>Tugas Mendesak</b><br><span id="urgentCount">0 tugas prioritas tinggi</span></div>
        <div class="hero-chip"><b>Risiko Deadline</b><br><span id="overdueCount">0 tugas terlambat</span></div>
        <div class="hero-chip"><b>Mode Tampilan</b><br><span id="activeViewText">Table View</span></div>
        <div class="hero-chip">
          <b>User Aktif</b><br><span id="activeUserLabel">-</span><br>
          <button type="button" id="logoutBtn" class="chip-logout">Logout</button>
        </div>
      </div>
    </header>
    <section class="kpi-grid">
      <article class="glass kpi"><h3>Total Tugas</h3><div class="v" id="kpiTotal">0</div></article>
      <article class="glass kpi"><h3>Selesai</h3><div class="v" id="kpiDone">0</div></article>
      <article class="glass kpi"><h3>On Progress</h3><div class="v" id="kpiProgress">0</div></article>
      <article class="glass kpi"><h3>Estimasi Jam</h3><div class="v" id="kpiEstimate">0.0</div></article>
      <article class="glass kpi"><h3>Aktual Jam</h3><div class="v" id="kpiActual">0.0</div></article>
      <article class="glass kpi"><h3>Efisiensi</h3><div class="v" id="kpiEfficiency">-</div></article>
    </section>

    <section class="workspace">
      <aside class="glass side">
        <div class="block">
          <h3>Profil Pengguna</h3>
          <div class="profile-head">
            <div class="profile-avatar" id="profileAvatar">U</div>
            <div>
              <p class="profile-name" id="profileDisplayName">-</p>
              <p class="profile-role" id="profileDisplayRole">Role belum diatur</p>
            </div>
          </div>

          <form id="profileForm" class="f">
            <div>
              <label for="profileName">Nama Lengkap</label>
              <input id="profileName" required>
            </div>
            <div>
              <label for="profileEmail">Email</label>
              <input id="profileEmail" readonly>
            </div>
            <div class="ig-grid">
              <div>
                <label for="profileRole">Role</label>
                <input id="profileRole" placeholder="Contoh: Social Media Specialist">
              </div>
              <div>
                <label for="profileDepartment">Divisi</label>
                <input id="profileDepartment" placeholder="Contoh: Marketing">
              </div>
            </div>
            <div>
              <label for="profilePhone">No. WhatsApp</label>
              <input id="profilePhone" placeholder="Contoh: 0812xxxxxx">
            </div>
            <div>
              <label for="profileBio">Bio Singkat</label>
              <textarea id="profileBio" placeholder="Fokus pekerjaan, tanggung jawab, dan target Anda..."></textarea>
            </div>
            <button class="btn soft" type="submit" id="saveProfileBtn">Simpan Profil</button>
          </form>
          <p class="hint" id="profileSaveStatus">Data profil disimpan per akun dan tetap ada setelah logout.</p>
        </div>

        <div class="block">
          <h2>Tambah Tugas</h2>
          <form id="taskForm" class="f">
            <div>
              <label for="title">Nama Tugas</label>
              <input id="title" required placeholder="Contoh: Desain social media carousel">
            </div>
            <div class="row">
              <div>
                <label for="type">Kategori</label>
                <select id="type">
                  <option value="Web Development">Web Development</option>
                  <option value="Graphic Design">Graphic Design</option>
                </select>
              </div>
              <div>
                <label for="priority">Prioritas</label>
                <select id="priority">
                  <option value="High">High</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="Low">Low</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div>
                <label for="status">Status</label>
                <select id="status">
                  <option value="To Do">To Do</option>
                  <option value="In Progress">In Progress</option>
                  <option value="Review">Review</option>
                  <option value="Done">Done</option>
                </select>
              </div>
              <div>
                <label for="dueDate">Deadline</label>
                <input id="dueDate" type="date">
              </div>
            </div>
            <div class="row">
              <div>
                <label for="estimateHours">Estimasi Jam</label>
                <input id="estimateHours" type="number" min="0" step="0.5" value="1">
              </div>
              <div>
                <label for="actualHours">Jam Aktual</label>
                <input id="actualHours" type="number" min="0" step="0.5" value="0">
              </div>
            </div>
            <div>
              <label for="notes">Catatan</label>
              <textarea id="notes" placeholder="Link referensi, brief, komentar revisi..."></textarea>
            </div>
            <div class="btn-row">
              <button class="btn primary" type="submit">Simpan</button>
              <button class="btn soft" type="button" id="seedDemo">Muat Demo</button>
            </div>
          </form>
        </div>

        <div class="block">
          <h3>Progress Keseluruhan</h3>
          <div class="progress-wrap">
            <div class="progress-head">
              <span>Completion Rate</span>
              <span id="progressText">0%</span>
            </div>
            <div class="bar"><span id="progressBar"></span></div>
          </div>
          <p class="meta" id="progressMeta">Belum ada data tugas.</p>
        </div>

        <div class="block">
          <h3>Laporan WhatsApp Desain</h3>
          <p class="meta" id="reportMeta">Tugas desain: 0/5.</p>
          <div style="display:flex; gap:8px; margin-top:6px;">
            <label class="small" style="display:flex; gap:6px; align-items:center;">
              <input id="doneOnlyReport" type="checkbox" style="width:auto; margin:0;">
              Hanya status Done
            </label>
          </div>
          <div class="preview" id="waPreview">Laporan akan muncul di sini.</div>
          <div class="btn-row" style="margin-top:8px;">
            <button class="btn soft" type="button" id="copyWaReport" disabled>Salin Laporan</button>
            <button class="btn wa" type="button" id="openWaReport" disabled>Kirim ke WA</button>
          </div>
          <p class="hint" id="waStatus">Tambah 5 tugas desain untuk aktifkan report WA.</p>
        </div>

        <div class="block">
          <h3>Instagram Timeline Ideal</h3>
          <p class="meta">Input data performa posting untuk menghitung jam posting terbaik dan rekomendasi timeline mingguan.</p>

          <form id="igForm" class="f" style="margin-top:8px;">
            <div class="ig-grid">
              <div>
                <label for="igDate">Tanggal Post</label>
                <input id="igDate" type="date" required>
              </div>
              <div>
                <label for="igTime">Jam Post</label>
                <input id="igTime" type="time" required>
              </div>
            </div>
            <div class="ig-grid">
              <div>
                <label for="igContentType">Jenis Konten</label>
                <select id="igContentType">
                  <option value="Reels">Reels</option>
                  <option value="Carousel">Carousel</option>
                  <option value="Single Image">Single Image</option>
                  <option value="Story">Story</option>
                </select>
              </div>
              <div>
                <label for="igReach">Reach</label>
                <input id="igReach" type="number" min="1" value="1000" required>
              </div>
            </div>
            <div class="ig-grid">
              <div>
                <label for="igLikes">Likes</label>
                <input id="igLikes" type="number" min="0" value="0">
              </div>
              <div>
                <label for="igComments">Comments</label>
                <input id="igComments" type="number" min="0" value="0">
              </div>
            </div>
            <div class="ig-grid">
              <div>
                <label for="igShares">Shares</label>
                <input id="igShares" type="number" min="0" value="0">
              </div>
              <div>
                <label for="igSaves">Saves</label>
                <input id="igSaves" type="number" min="0" value="0">
              </div>
            </div>

            <div class="btn-row">
              <button class="btn primary" type="submit">Tambah Data IG</button>
              <button class="btn soft" type="button" id="seedIgData">Demo IG</button>
            </div>
            <div class="btn-row">
              <button class="btn danger" type="button" id="clearIgData">Reset Data IG</button>
            </div>
          </form>

          <div class="ig-live-card" id="igRealtimeCard">
            <div class="ig-live-title" id="igRealtimeTitle">Next Upload</div>
            <div class="ig-live-countdown" id="igRealtimeCountdown">--:--:--</div>
            <div class="ig-live-meta" id="igRealtimeMeta">Sinkronisasi timeline sedang menunggu data.</div>
          </div>

          <div class="ig-top" id="igTopSlots">Top slots akan muncul setelah ada data posting.</div>
          <div class="ig-consistency" id="igConsistency">Target konsistensi: 5 posting per minggu.</div>
          <p class="hint" id="igInsights">Belum ada data posting IG.</p>
          <div class="ig-timeline" id="igTimeline"></div>
        </div>

        <div class="block">
          <h3>Data Tools</h3>
          <div class="btn-row">
            <button class="btn soft" type="button" id="exportJson">Export JSON</button>
            <button class="btn soft" type="button" id="importJson">Import JSON</button>
          </div>
          <input id="importFile" type="file" accept=".json,application/json" class="hidden">
          <div class="btn-row" style="margin-top:8px;">
            <button class="btn danger" type="button" id="clearAll">Hapus Semua</button>
          </div>
        </div>
      </aside>

      <main class="glass main">
        <div class="toolbar">
          <input id="searchInput" placeholder="Cari tugas / catatan...">
          <select id="filterType">
            <option value="all">Semua Kategori</option>
            <option value="Web Development">Web Development</option>
            <option value="Graphic Design">Graphic Design</option>
          </select>
          <select id="filterStatus">
            <option value="all">Semua Status</option>
            <option value="To Do">To Do</option>
            <option value="In Progress">In Progress</option>
            <option value="Review">Review</option>
            <option value="Done">Done</option>
          </select>
          <select id="filterPriority">
            <option value="all">Semua Prioritas</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>
          <div class="view-switch">
            <button id="tableBtn" class="active" type="button">Table</button>
            <button id="kanbanBtn" type="button">Kanban</button>
          </div>
        </div>

        <div class="insight-grid">
          <article class="insight">
            <h3>Overall Completion</h3>
            <div class="ring" id="doneRing">0%</div>
            <div class="mini-line"><span>Selesai</span><span id="insDone">0</span></div>
            <div class="mini-line"><span>Belum Selesai</span><span id="insPending">0</span></div>
          </article>
          <article class="insight">
            <h3>Kategori Web Dev</h3>
            <div class="mini-line"><span>Total</span><span id="webTotal">0</span></div>
            <div class="mini-line"><span>Done</span><span id="webDone">0</span></div>
            <div class="mini-line"><span>Progress</span><span id="webProgress">0%</span></div>
          </article>
          <article class="insight">
            <h3>Kategori Design</h3>
            <div class="mini-line"><span>Total</span><span id="designTotal">0</span></div>
            <div class="mini-line"><span>Done</span><span id="designDone">0</span></div>
            <div class="mini-line"><span>Progress</span><span id="designProgress">0%</span></div>
          </article>
        </div>

        <section class="task-area">
          <div class="table-wrap" id="tableView">
            <table>
              <thead>
                <tr>
                  <th>Tugas</th>
                  <th>Kategori</th>
                  <th>Prioritas</th>
                  <th>Status</th>
                  <th>Deadline</th>
                  <th>Estimasi</th>
                  <th>Aktual</th>
                  <th>Efisiensi</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="taskBody"></tbody>
            </table>
          </div>
          <div id="kanbanView" class="kanban hidden"></div>
        </section>
      </main>
    </section>
  </div>

  <script>
    const TASK_STORAGE_PREFIX = "taskflow_pro_v2";
    const IG_STORAGE_PREFIX = "taskflow_ig_posts_v1";
    const PROFILE_STORAGE_PREFIX = "taskflow_profile_v1";
    const USERS_STORAGE_KEY = "taskflow_users_v1";
    const SESSION_STORAGE_KEY = "taskflow_session_v1";
    const STATUS_ORDER = ["To Do", "In Progress", "Review", "Done"];
    const PRIORITY_ORDER = { High: 1, Medium: 2, Low: 3 };
    const DESIGN_REPORT_THRESHOLD = 5;
    const IG_WEEKLY_TARGET = 5;
    const IG_DAYS = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    const IG_DAY_LABEL = {
      Monday: "Senin",
      Tuesday: "Selasa",
      Wednesday: "Rabu",
      Thursday: "Kamis",
      Friday: "Jumat",
      Saturday: "Sabtu",
      Sunday: "Minggu"
    };
    const IG_DEFAULT_SLOTS = {
      Monday: ["11:30", "19:00"],
      Tuesday: ["12:00", "19:30"],
      Wednesday: ["11:30", "20:00"],
      Thursday: ["12:00", "19:00"],
      Friday: ["11:30", "18:30"],
      Saturday: ["09:30", "19:00"],
      Sunday: ["10:00", "19:30"]
    };

    const refs = {
      authApp: document.getElementById("authApp"),
      authCard: document.getElementById("authCard"),
      dashboardApp: document.getElementById("dashboardApp"),
      showLoginTab: document.getElementById("showLoginTab"),
      showSignupTab: document.getElementById("showSignupTab"),
      loginForm: document.getElementById("loginForm"),
      signupForm: document.getElementById("signupForm"),
      authMessage: document.getElementById("authMessage"),
      loginEmail: document.getElementById("loginEmail"),
      loginPassword: document.getElementById("loginPassword"),
      signupName: document.getElementById("signupName"),
      signupEmail: document.getElementById("signupEmail"),
      signupPassword: document.getElementById("signupPassword"),
      signupPasswordConfirm: document.getElementById("signupPasswordConfirm"),
      activeUserLabel: document.getElementById("activeUserLabel"),
      logoutBtn: document.getElementById("logoutBtn"),
      profileForm: document.getElementById("profileForm"),
      profileAvatar: document.getElementById("profileAvatar"),
      profileDisplayName: document.getElementById("profileDisplayName"),
      profileDisplayRole: document.getElementById("profileDisplayRole"),
      profileName: document.getElementById("profileName"),
      profileEmail: document.getElementById("profileEmail"),
      profileRole: document.getElementById("profileRole"),
      profileDepartment: document.getElementById("profileDepartment"),
      profilePhone: document.getElementById("profilePhone"),
      profileBio: document.getElementById("profileBio"),
      saveProfileBtn: document.getElementById("saveProfileBtn"),
      profileSaveStatus: document.getElementById("profileSaveStatus"),
      clock: document.getElementById("clock"),
      urgentCount: document.getElementById("urgentCount"),
      overdueCount: document.getElementById("overdueCount"),
      activeViewText: document.getElementById("activeViewText"),
      taskForm: document.getElementById("taskForm"),
      title: document.getElementById("title"),
      type: document.getElementById("type"),
      priority: document.getElementById("priority"),
      status: document.getElementById("status"),
      dueDate: document.getElementById("dueDate"),
      estimateHours: document.getElementById("estimateHours"),
      actualHours: document.getElementById("actualHours"),
      notes: document.getElementById("notes"),
      seedDemo: document.getElementById("seedDemo"),
      progressText: document.getElementById("progressText"),
      progressBar: document.getElementById("progressBar"),
      progressMeta: document.getElementById("progressMeta"),
      reportMeta: document.getElementById("reportMeta"),
      doneOnlyReport: document.getElementById("doneOnlyReport"),
      waPreview: document.getElementById("waPreview"),
      copyWaReport: document.getElementById("copyWaReport"),
      openWaReport: document.getElementById("openWaReport"),
      waStatus: document.getElementById("waStatus"),
      igForm: document.getElementById("igForm"),
      igDate: document.getElementById("igDate"),
      igTime: document.getElementById("igTime"),
      igContentType: document.getElementById("igContentType"),
      igReach: document.getElementById("igReach"),
      igLikes: document.getElementById("igLikes"),
      igComments: document.getElementById("igComments"),
      igShares: document.getElementById("igShares"),
      igSaves: document.getElementById("igSaves"),
      igRealtimeCard: document.getElementById("igRealtimeCard"),
      igRealtimeTitle: document.getElementById("igRealtimeTitle"),
      igRealtimeCountdown: document.getElementById("igRealtimeCountdown"),
      igRealtimeMeta: document.getElementById("igRealtimeMeta"),
      igTopSlots: document.getElementById("igTopSlots"),
      igConsistency: document.getElementById("igConsistency"),
      igInsights: document.getElementById("igInsights"),
      igTimeline: document.getElementById("igTimeline"),
      seedIgData: document.getElementById("seedIgData"),
      clearIgData: document.getElementById("clearIgData"),
      exportJson: document.getElementById("exportJson"),
      importJson: document.getElementById("importJson"),
      importFile: document.getElementById("importFile"),
      clearAll: document.getElementById("clearAll"),
      searchInput: document.getElementById("searchInput"),
      filterType: document.getElementById("filterType"),
      filterStatus: document.getElementById("filterStatus"),
      filterPriority: document.getElementById("filterPriority"),
      tableBtn: document.getElementById("tableBtn"),
      kanbanBtn: document.getElementById("kanbanBtn"),
      tableView: document.getElementById("tableView"),
      kanbanView: document.getElementById("kanbanView"),
      taskBody: document.getElementById("taskBody"),
      doneRing: document.getElementById("doneRing"),
      insDone: document.getElementById("insDone"),
      insPending: document.getElementById("insPending"),
      webTotal: document.getElementById("webTotal"),
      webDone: document.getElementById("webDone"),
      webProgress: document.getElementById("webProgress"),
      designTotal: document.getElementById("designTotal"),
      designDone: document.getElementById("designDone"),
      designProgress: document.getElementById("designProgress"),
      kpiTotal: document.getElementById("kpiTotal"),
      kpiDone: document.getElementById("kpiDone"),
      kpiProgress: document.getElementById("kpiProgress"),
      kpiEstimate: document.getElementById("kpiEstimate"),
      kpiActual: document.getElementById("kpiActual"),
      kpiEfficiency: document.getElementById("kpiEfficiency")
    };

    let tasks = [];
    let igPosts = [];
    let activeView = "table";
    let currentUser = null;
    let currentProfile = null;

    function normalizeTask(raw) {
      return {
        id: raw.id || crypto.randomUUID(),
        title: String(raw.title || "").trim(),
        type: raw.type === "Graphic Design" ? "Graphic Design" : "Web Development",
        priority: ["High", "Medium", "Low"].includes(raw.priority) ? raw.priority : "Medium",
        status: STATUS_ORDER.includes(raw.status) ? raw.status : "To Do",
        dueDate: raw.dueDate || "",
        estimateHours: Number(raw.estimateHours) || 0,
        actualHours: Number(raw.actualHours) || 0,
        notes: String(raw.notes || ""),
        createdAt: raw.createdAt || new Date().toISOString(),
        completedAt: raw.completedAt || ""
      };
    }

    function normalizeEmail(email) {
      return String(email || "").trim().toLowerCase();
    }

    function getTaskStorageKey(email) {
      return `${TASK_STORAGE_PREFIX}_${normalizeEmail(email)}`;
    }

    function getIGStorageKey(email) {
      return `${IG_STORAGE_PREFIX}_${normalizeEmail(email)}`;
    }

    function getProfileStorageKey(email) {
      return `${PROFILE_STORAGE_PREFIX}_${normalizeEmail(email)}`;
    }

    function defaultProfileFromUser(user) {
      const baseName = String(user && user.name ? user.name : user && user.email ? user.email : "User").trim();
      return {
        name: baseName,
        email: normalizeEmail(user && user.email ? user.email : ""),
        role: "",
        department: "",
        phone: "",
        bio: "",
        updatedAt: ""
      };
    }

    function getInitials(name) {
      const parts = String(name || "")
        .trim()
        .split(/\s+/)
        .filter(Boolean);
      if (!parts.length) return "U";
      if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
      return (parts[0][0] + parts[1][0]).toUpperCase();
    }

    function setProfileStatus(message, type) {
      refs.profileSaveStatus.textContent = message || "";
      if (type === "error") {
        refs.profileSaveStatus.style.color = "var(--danger)";
      } else if (type === "success") {
        refs.profileSaveStatus.style.color = "var(--done)";
      } else {
        refs.profileSaveStatus.style.color = "var(--muted)";
      }
    }

    function renderProfileHeader(profile) {
      const safeName = String(profile && profile.name ? profile.name : currentUser ? currentUser.email : "User").trim();
      const roleText = String(profile && profile.role ? profile.role : "").trim();
      refs.profileDisplayName.textContent = safeName;
      refs.profileDisplayRole.textContent = roleText || "Role belum diatur";
      refs.profileAvatar.textContent = getInitials(safeName);
      if (currentUser) {
        refs.activeUserLabel.textContent = `${safeName} (${currentUser.email})`;
      }
    }

    function fillProfileForm(profile) {
      refs.profileName.value = profile.name || "";
      refs.profileEmail.value = profile.email || "";
      refs.profileRole.value = profile.role || "";
      refs.profileDepartment.value = profile.department || "";
      refs.profilePhone.value = profile.phone || "";
      refs.profileBio.value = profile.bio || "";
      renderProfileHeader(profile);
    }

    function loadUserProfile(user) {
      const defaults = defaultProfileFromUser(user);
      try {
        const raw = localStorage.getItem(getProfileStorageKey(defaults.email));
        if (!raw) return defaults;
        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") return defaults;
        return {
          ...defaults,
          ...parsed,
          email: defaults.email
        };
      } catch (_) {
        return defaults;
      }
    }

    function saveCurrentProfile(showFeedback) {
      if (!currentUser) return;
      const name = String(refs.profileName.value || "").trim();
      if (!name) {
        setProfileStatus("Nama lengkap wajib diisi.", "error");
        return;
      }

      const profile = {
        name,
        email: normalizeEmail(currentUser.email),
        role: String(refs.profileRole.value || "").trim(),
        department: String(refs.profileDepartment.value || "").trim(),
        phone: String(refs.profilePhone.value || "").trim(),
        bio: String(refs.profileBio.value || "").trim(),
        updatedAt: new Date().toISOString()
      };

      currentProfile = profile;
      localStorage.setItem(getProfileStorageKey(profile.email), JSON.stringify(profile));

      const users = loadUsers();
      const idx = users.findIndex(u => normalizeEmail(u.email) === profile.email);
      if (idx >= 0) {
        users[idx].name = profile.name;
        saveUsers(users);
      }

      if (currentUser) currentUser.name = profile.name;
      renderProfileHeader(profile);
      if (showFeedback) {
        setProfileStatus("Profil berhasil disimpan. Data tetap tersimpan saat logout.", "success");
      }
    }

    function normalizeIGPost(raw) {
      return {
        id: raw.id || crypto.randomUUID(),
        date: String(raw.date || ""),
        time: String(raw.time || "12:00"),
        contentType: String(raw.contentType || "Reels"),
        reach: Math.max(1, Number(raw.reach) || 1),
        likes: Math.max(0, Number(raw.likes) || 0),
        comments: Math.max(0, Number(raw.comments) || 0),
        shares: Math.max(0, Number(raw.shares) || 0),
        saves: Math.max(0, Number(raw.saves) || 0),
        createdAt: raw.createdAt || new Date().toISOString()
      };
    }

    function loadIGPosts(email) {
      try {
        const raw = localStorage.getItem(getIGStorageKey(email));
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (_) {
        return [];
      }
    }

    function saveIGPosts() {
      if (!currentUser) return;
      localStorage.setItem(getIGStorageKey(currentUser.email), JSON.stringify(igPosts));
    }

    function getIGDayFromDate(dateStr) {
      if (!dateStr) return "Monday";
      const d = new Date(dateStr + "T00:00:00");
      if (Number.isNaN(d.getTime())) return "Monday";
      const map = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      return map[d.getDay()] || "Monday";
    }

    function computeIGEngagementRate(post) {
      const reach = Math.max(1, Number(post.reach) || 1);
      const interactions =
        (Number(post.likes) || 0) +
        (Number(post.comments) || 0) * 2 +
        (Number(post.shares) || 0) * 3 +
        (Number(post.saves) || 0) * 3;
      return (interactions / reach) * 100;
    }

    function getInstagramTimelineAnalytics() {
      const aggregates = {};
      const perDay = {};

      for (const post of igPosts) {
        const day = getIGDayFromDate(post.date);
        const time = String(post.time || "12:00").slice(0, 5);
        const score = computeIGEngagementRate(post);
        const key = `${day}|${time}`;
        if (!aggregates[key]) {
          aggregates[key] = { day, time, total: 0, count: 0 };
        }
        aggregates[key].total += score;
        aggregates[key].count += 1;
      }

      const slotStats = Object.values(aggregates).map(s => ({
        ...s,
        avg: s.count ? s.total / s.count : 0
      })).sort((a, b) => b.avg - a.avg);

      for (const stat of slotStats) {
        if (!perDay[stat.day]) perDay[stat.day] = [];
        perDay[stat.day].push(stat);
      }

      const topSlots = slotStats.slice(0, 3);
      const weekPlan = IG_DAYS.map(day => {
        const best = perDay[day] && perDay[day][0] ? perDay[day][0] : null;
        const fallback = IG_DEFAULT_SLOTS[day] || ["12:00", "19:00"];
        const secondaryData = perDay[day] && perDay[day][1] ? perDay[day][1].time : null;
        return {
          day,
          label: IG_DAY_LABEL[day] || day,
          primary: best ? best.time : fallback[0],
          secondary: secondaryData || fallback[1],
          source: best ? "Data" : "Baseline"
        };
      });

      const avgRate = igPosts.length
        ? igPosts.reduce((sum, p) => sum + computeIGEngagementRate(p), 0) / igPosts.length
        : 0;

      return { weekPlan, topSlots, avgRate };
    }

    function getJsDayFromIGDay(day) {
      const map = {
        Sunday: 0,
        Monday: 1,
        Tuesday: 2,
        Wednesday: 3,
        Thursday: 4,
        Friday: 5,
        Saturday: 6
      };
      return map[day] ?? 1;
    }

    function getWeekStart(date) {
      const d = new Date(date);
      const jsDay = d.getDay();
      const diff = jsDay === 0 ? -6 : 1 - jsDay;
      d.setDate(d.getDate() + diff);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    function getWeekEnd(date) {
      const start = getWeekStart(date);
      const end = new Date(start);
      end.setDate(start.getDate() + 6);
      end.setHours(23, 59, 59, 999);
      return end;
    }

    function getWeeklyPostCount(date) {
      const start = getWeekStart(date);
      const end = getWeekEnd(date);
      return igPosts.filter(post => {
        if (!post.date) return false;
        const t = new Date(post.date + "T12:00:00").getTime();
        return t >= start.getTime() && t <= end.getTime();
      }).length;
    }

    function buildSlotDateTime(day, time, fromDate) {
      const targetDay = getJsDayFromIGDay(day);
      const [h, m] = String(time || "12:00").split(":").map(Number);
      const base = new Date(fromDate);
      const offset = (targetDay - base.getDay() + 7) % 7;
      const candidate = new Date(base);
      candidate.setDate(base.getDate() + offset);
      candidate.setHours(Number.isFinite(h) ? h : 12, Number.isFinite(m) ? m : 0, 0, 0);
      return candidate;
    }

    function getNextUploadSlot(weekPlan, now) {
      let next = null;
      for (const daySlot of weekPlan) {
        for (const slotType of ["primary", "secondary"]) {
          const time = daySlot[slotType];
          const candidate = buildSlotDateTime(daySlot.day, time, now);
          let candidateTs = candidate.getTime();
          if (candidateTs < now.getTime()) {
            candidate.setDate(candidate.getDate() + 7);
            candidateTs = candidate.getTime();
          }
          if (!next || candidateTs < next.when.getTime()) {
            next = {
              day: daySlot.day,
              label: daySlot.label,
              time,
              slotType,
              when: candidate
            };
          }
        }
      }
      return next;
    }

    function formatRemaining(ms) {
      const total = Math.max(0, Math.floor(ms / 1000));
      const d = Math.floor(total / 86400);
      const h = Math.floor((total % 86400) / 3600);
      const m = Math.floor((total % 3600) / 60);
      const s = total % 60;
      if (d > 0) return `${d}h ${String(h).padStart(2, "0")}j ${String(m).padStart(2, "0")}m`;
      return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    function renderInstagramTimeline() {
      const analytics = getInstagramTimelineAnalytics();
      const totalPosts = igPosts.length;

      if (!totalPosts) {
        refs.igTopSlots.textContent = "Top slots akan muncul setelah ada data posting.";
        refs.igInsights.textContent = "Belum ada data posting IG.";
        refs.igConsistency.textContent = `Target konsistensi: ${IG_WEEKLY_TARGET} posting per minggu. Progress minggu ini: 0/${IG_WEEKLY_TARGET}.`;
        refs.igTimeline.innerHTML = IG_DAYS.map((day, idx) => `
          <div class="ig-row" data-day="${day}" style="animation-delay:${idx * 0.03}s;">
            <div class="ig-day">${IG_DAY_LABEL[day]}</div>
            <div class="ig-slot-wrap">
              <span class="ig-slot" data-day="${day}" data-time="${IG_DEFAULT_SLOTS[day][0]}" data-kind="primary">${IG_DEFAULT_SLOTS[day][0]}</span>
              <span class="ig-slot secondary" data-day="${day}" data-time="${IG_DEFAULT_SLOTS[day][1]}" data-kind="secondary">${IG_DEFAULT_SLOTS[day][1]}</span>
              <span class="ig-badge">Baseline</span>
            </div>
          </div>
        `).join("");
        updateInstagramRealtimeStatus();
        return;
      }

      const topLines = analytics.topSlots.length
        ? analytics.topSlots.map((slot, i) => `${i + 1}. ${IG_DAY_LABEL[slot.day]} ${slot.time}  | Avg ER ${slot.avg.toFixed(2)}%`).join("\n")
        : "Belum ada slot terbaik.";

      refs.igTopSlots.textContent = `Top Jam Posting\n${topLines}`;
      refs.igInsights.textContent = `Data posting: ${totalPosts} konten. Rata-rata engagement rate: ${analytics.avgRate.toFixed(2)}%.`;
      const weeklyCount = getWeeklyPostCount(new Date());
      const consistencyPct = Math.min(100, Math.round((weeklyCount / IG_WEEKLY_TARGET) * 100));
      refs.igConsistency.textContent = `Konsistensi minggu ini: ${weeklyCount}/${IG_WEEKLY_TARGET} posting (${consistencyPct}%). ${weeklyCount >= IG_WEEKLY_TARGET ? "Target tercapai." : "Tambahkan konten sesuai slot rekomendasi."}`;
      refs.igTimeline.innerHTML = analytics.weekPlan.map((slot, idx) => `
        <div class="ig-row" data-day="${slot.day}" style="animation-delay:${idx * 0.03}s;">
          <div class="ig-day">${slot.label}</div>
          <div class="ig-slot-wrap">
            <span class="ig-slot" data-day="${slot.day}" data-time="${slot.primary}" data-kind="primary">${slot.primary}</span>
            <span class="ig-slot secondary" data-day="${slot.day}" data-time="${slot.secondary}" data-kind="secondary">${slot.secondary}</span>
            <span class="ig-badge">${slot.source}</span>
          </div>
        </div>
      `).join("");
      updateInstagramRealtimeStatus();
    }

    function updateInstagramRealtimeStatus() {
      if (!refs.igTimeline) return;
      const analytics = getInstagramTimelineAnalytics();
      const plan = analytics.weekPlan || [];
      if (!plan.length) return;

      const now = new Date();
      const currentDay = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][now.getDay()];
      const slotsEl = refs.igTimeline.querySelectorAll(".ig-slot");
      const rowsEl = refs.igTimeline.querySelectorAll(".ig-row");

      rowsEl.forEach(row => {
        row.classList.toggle("today", row.dataset.day === currentDay);
      });

      slotsEl.forEach(el => {
        el.classList.remove("now", "next", "missed");
      });

      let activeNow = null;
      slotsEl.forEach(el => {
        if (el.dataset.day !== currentDay) return;
        const scheduled = buildSlotDateTime(el.dataset.day, el.dataset.time, now);
        const diffMin = (scheduled.getTime() - now.getTime()) / 60000;
        if (Math.abs(diffMin) <= 45) {
          el.classList.add("now");
          activeNow = { day: el.dataset.day, time: el.dataset.time };
        } else if (diffMin < -45) {
          el.classList.add("missed");
        }
      });

      const nextSlot = getNextUploadSlot(plan, now);
      if (nextSlot) {
        const selector = `.ig-slot[data-day="${nextSlot.day}"][data-time="${nextSlot.time}"]`;
        const nextEl = refs.igTimeline.querySelector(selector);
        if (nextEl && !nextEl.classList.contains("now")) {
          nextEl.classList.add("next");
        }

        if (activeNow) {
          refs.igRealtimeTitle.textContent = "Waktu Ideal Posting: Sekarang";
          refs.igRealtimeCountdown.textContent = `POST NOW (${IG_DAY_LABEL[activeNow.day]} ${activeNow.time})`;
          refs.igRealtimeMeta.textContent = "Slot emas sedang aktif. Upload sekarang untuk menjaga konsistensi dan momentum engagement.";
        } else {
          const remaining = nextSlot.when.getTime() - now.getTime();
          refs.igRealtimeTitle.textContent = "Next Upload";
          refs.igRealtimeCountdown.textContent = formatRemaining(remaining);
          refs.igRealtimeMeta.textContent = `${nextSlot.label} ${nextSlot.time} (${nextSlot.slotType === "primary" ? "slot utama" : "slot cadangan"}).`;
        }
      }
    }

    function loadUsers() {
      try {
        const raw = localStorage.getItem(USERS_STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (_) {
        return [];
      }
    }

    function saveUsers(users) {
      localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
    }

    function hashPassword(password) {
      try {
        return btoa(unescape(encodeURIComponent(String(password || ""))));
      } catch (_) {
        return String(password || "");
      }
    }

    function setAuthMessage(message, type) {
      const resolvedType = type === true ? "error" : type === false ? "" : String(type || "");
      refs.authMessage.textContent = message || "";
      refs.authMessage.classList.toggle("error", resolvedType === "error");
      refs.authMessage.classList.toggle("success", resolvedType === "success");
      refs.authMessage.style.opacity = message ? "1" : "0.82";
      refs.authMessage.style.transform = message ? "translateY(0)" : "translateY(-1px)";
    }

    function animateAuthForm(formEl, animationClass) {
      formEl.classList.remove(animationClass);
      void formEl.offsetWidth;
      formEl.classList.add(animationClass);
    }

    function switchAuthTab(mode) {
      const isLogin = mode === "login";
      refs.authCard.dataset.mode = isLogin ? "login" : "signup";
      refs.showLoginTab.classList.toggle("active", isLogin);
      refs.showSignupTab.classList.toggle("active", !isLogin);
      refs.loginForm.classList.toggle("hidden", !isLogin);
      refs.signupForm.classList.toggle("hidden", isLogin);
      animateAuthForm(isLogin ? refs.loginForm : refs.signupForm, "reveal");
      setAuthMessage("");
    }

    function loadTasks(email) {
      try {
        const raw = localStorage.getItem(getTaskStorageKey(email));
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (_) {
        return [];
      }
    }

    function saveTasks() {
      if (!currentUser) return;
      localStorage.setItem(getTaskStorageKey(currentUser.email), JSON.stringify(tasks));
    }

    function startSession(user) {
      currentUser = {
        name: String(user.name || "").trim() || user.email,
        email: normalizeEmail(user.email)
      };
      localStorage.setItem(SESSION_STORAGE_KEY, currentUser.email);
      currentProfile = loadUserProfile(currentUser);
      fillProfileForm(currentProfile);
      setProfileStatus("Data profil disimpan per akun dan tetap ada setelah logout.");
      tasks = loadTasks(currentUser.email).map(normalizeTask);
      igPosts = loadIGPosts(currentUser.email).map(normalizeIGPost);
      refs.authApp.classList.add("hidden");
      refs.dashboardApp.classList.remove("hidden");
      if (!refs.igDate.value) refs.igDate.value = new Date().toISOString().slice(0, 10);
      if (!refs.igTime.value) refs.igTime.value = "12:00";
      setView(activeView);
      rerender();
    }

    function logout() {
      if (currentUser) {
        saveCurrentProfile(false);
      }
      currentUser = null;
      currentProfile = null;
      tasks = [];
      igPosts = [];
      localStorage.removeItem(SESSION_STORAGE_KEY);
      refs.dashboardApp.classList.add("hidden");
      refs.authApp.classList.remove("hidden");
      switchAuthTab("login");
      refs.loginForm.reset();
      refs.signupForm.reset();
      refs.profileForm.reset();
      setAuthMessage("Anda telah logout.");
    }

    function restoreSession() {
      const email = normalizeEmail(localStorage.getItem(SESSION_STORAGE_KEY));
      if (!email) return false;
      const users = loadUsers();
      const user = users.find(u => normalizeEmail(u.email) === email);
      if (!user) return false;
      startSession(user);
      return true;
    }

    function escapeHtml(value) {
      return String(value)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function formatDate(dateStr) {
      if (!dateStr) return "-";
      const d = new Date(dateStr + "T00:00:00");
      if (Number.isNaN(d.getTime())) return "-";
      return d.toLocaleDateString("id-ID", { day: "2-digit", month: "short", year: "numeric" });
    }

    function isOverdue(task) {
      if (!task.dueDate || task.status === "Done") return false;
      const due = new Date(task.dueDate + "T23:59:59").getTime();
      return Date.now() > due;
    }

    function statusClass(status) {
      if (status === "In Progress") return "s-progress";
      if (status === "Review") return "s-review";
      if (status === "Done") return "s-done";
      return "s-todo";
    }

    function priorityClass(priority) {
      if (priority === "High") return "prio-high";
      if (priority === "Low") return "prio-low";
      return "prio-medium";
    }

    function typeClass(type) {
      return type === "Graphic Design" ? "p-design" : "p-web";
    }

    function hasDesignKeyword(text) {
      return /\b(desain|design)\b/i.test(String(text || ""));
    }

    function hasWebsiteKeyword(text) {
      return /\b(web|website|frontend|backend|landing\s?page)\b/i.test(String(text || ""));
    }

    function computeEfficiency(est, act, status) {
      const e = Number(est) || 0;
      const a = Number(act) || 0;
      if (status !== "Done" || e <= 0 || a <= 0) return "-";
      return ((e / a) * 100).toFixed(0) + "%";
    }

    function getStats() {
      const total = tasks.length;
      const done = tasks.filter(t => t.status === "Done").length;
      const inProgress = tasks.filter(t => t.status === "In Progress").length;
      const est = tasks.reduce((s, t) => s + (Number(t.estimateHours) || 0), 0);
      const act = tasks.reduce((s, t) => s + (Number(t.actualHours) || 0), 0);
      const overdue = tasks.filter(isOverdue).length;
      const urgent = tasks.filter(t => t.priority === "High" && t.status !== "Done").length;
      const web = tasks.filter(t => t.type === "Web Development");
      const design = tasks.filter(t => t.type === "Graphic Design");
      const webDone = web.filter(t => t.status === "Done").length;
      const designDone = design.filter(t => t.status === "Done").length;
      return {
        total, done, inProgress, est, act, overdue, urgent,
        pending: Math.max(0, total - done),
        completion: total ? Math.round((done / total) * 100) : 0,
        webTotal: web.length,
        webDone,
        webProgress: web.length ? Math.round((webDone / web.length) * 100) : 0,
        designTotal: design.length,
        designDone,
        designProgress: design.length ? Math.round((designDone / design.length) * 100) : 0
      };
    }

    function updateClock() {
      refs.clock.textContent = new Date().toLocaleString("id-ID", {
        weekday: "short",
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
    }

    function getFilteredTasks() {
      const q = refs.searchInput.value.trim().toLowerCase();
      const typeFilter = refs.filterType.value;
      const statusFilter = refs.filterStatus.value;
      const prioFilter = refs.filterPriority.value;

      const filtered = tasks.filter(task => {
        const textMatch = !q || task.title.toLowerCase().includes(q) || task.notes.toLowerCase().includes(q);
        const typeMatch = typeFilter === "all" || task.type === typeFilter;
        const statusMatch = statusFilter === "all" || task.status === statusFilter;
        const prioMatch = prioFilter === "all" || task.priority === prioFilter;
        return textMatch && typeMatch && statusMatch && prioMatch;
      });

      return filtered.sort((a, b) => {
        const sa = STATUS_ORDER.indexOf(a.status);
        const sb = STATUS_ORDER.indexOf(b.status);
        if (sa !== sb) return sa - sb;
        const pa = PRIORITY_ORDER[a.priority] || 99;
        const pb = PRIORITY_ORDER[b.priority] || 99;
        if (pa !== pb) return pa - pb;
        const da = a.dueDate ? new Date(a.dueDate).getTime() : Infinity;
        const db = b.dueDate ? new Date(b.dueDate).getTime() : Infinity;
        if (da !== db) return da - db;
        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
      });
    }

    function renderTable(filteredTasks) {
      if (!filteredTasks.length) {
        refs.taskBody.innerHTML = "<tr><td colspan='9' class='empty'>Tidak ada tugas sesuai filter.</td></tr>";
        return;
      }

      refs.taskBody.innerHTML = filteredTasks.map((task, idx) => {
        const overdueFlag = isOverdue(task) ? "<div class='small' style='color:#b22945;margin-top:4px;font-weight:700;'>Terlambat</div>" : "";
        return `
          <tr class="row-enter" style="animation-delay:${Math.min(idx * 0.035, 0.35)}s;">
            <td>
              <b>${escapeHtml(task.title)}</b>
              ${task.notes ? `<div class='small' style='margin-top:4px;color:#607292;'>${escapeHtml(task.notes)}</div>` : ""}
              ${overdueFlag}
            </td>
            <td><span class="pill ${typeClass(task.type)}">${task.type}</span></td>
            <td><span class="pill ${priorityClass(task.priority)}">${task.priority}</span></td>
            <td><span class="status ${statusClass(task.status)}">${task.status}</span></td>
            <td>${formatDate(task.dueDate)}</td>
            <td>${Number(task.estimateHours || 0).toFixed(1)} jam</td>
            <td>${Number(task.actualHours || 0).toFixed(1)} jam</td>
            <td>${computeEfficiency(task.estimateHours, task.actualHours, task.status)}</td>
            <td>
              <div class="action-row">
                <button class="mini" data-act="next" data-id="${task.id}">Next</button>
                <button class="mini" data-act="addtime" data-id="${task.id}">+0.5h</button>
                <button class="mini d" data-act="delete" data-id="${task.id}">Hapus</button>
              </div>
            </td>
          </tr>
        `;
      }).join("");
    }

    function renderKanban(filteredTasks) {
      const grouped = {
        "To Do": [],
        "In Progress": [],
        "Review": [],
        "Done": []
      };
      filteredTasks.forEach(task => grouped[task.status].push(task));

      const laneHtml = STATUS_ORDER.map((status, laneIndex) => {
        const cards = grouped[status].map((task, idx) => `
          <article class="task-card card-enter" style="animation-delay:${Math.min((laneIndex * 0.07) + (idx * 0.03), 0.5)}s;">
            <b>${escapeHtml(task.title)}</b>
            <div style="margin-top:6px;">
              <span class="pill ${typeClass(task.type)}">${task.type}</span>
              <span class="pill ${priorityClass(task.priority)}">${task.priority}</span>
            </div>
            <div class="task-meta">
              DL: ${formatDate(task.dueDate)}<br>
              Est: ${Number(task.estimateHours || 0).toFixed(1)}h | Akt: ${Number(task.actualHours || 0).toFixed(1)}h
            </div>
          </article>
        `).join("");
        return `
          <section class="lane lane-enter" style="animation-delay:${laneIndex * 0.06}s;">
            <h4>${status} (${grouped[status].length})</h4>
            ${cards || "<div class='small' style='color:#6c7f9f;'>Kosong</div>"}
          </section>
        `;
      }).join("");

      refs.kanbanView.innerHTML = laneHtml;
    }

    function updateKPIsAndInsights() {
      const s = getStats();

      refs.kpiTotal.textContent = s.total;
      refs.kpiDone.textContent = s.done;
      refs.kpiProgress.textContent = s.inProgress;
      refs.kpiEstimate.textContent = s.est.toFixed(1);
      refs.kpiActual.textContent = s.act.toFixed(1);
      refs.kpiEfficiency.textContent = s.est > 0 && s.act > 0 ? ((s.est / s.act) * 100).toFixed(0) + "%" : "-";

      refs.progressText.textContent = s.completion + "%";
      refs.progressBar.style.width = s.completion + "%";
      refs.progressMeta.textContent = `${s.done} selesai dari ${s.total} tugas. Pending: ${s.pending}.`;

      refs.doneRing.textContent = s.completion + "%";
      refs.doneRing.style.setProperty("--pct", s.completion + "%");
      refs.insDone.textContent = s.done;
      refs.insPending.textContent = s.pending;

      refs.webTotal.textContent = s.webTotal;
      refs.webDone.textContent = s.webDone;
      refs.webProgress.textContent = s.webProgress + "%";
      refs.designTotal.textContent = s.designTotal;
      refs.designDone.textContent = s.designDone;
      refs.designProgress.textContent = s.designProgress + "%";

      refs.urgentCount.textContent = `${s.urgent} tugas prioritas tinggi`;
      refs.overdueCount.textContent = `${s.overdue} tugas terlambat`;
    }

    function collectDesignData() {
      const allDesign = tasks.filter(t => t.type === "Graphic Design");
      const source = refs.doneOnlyReport.checked ? allDesign.filter(t => t.status === "Done") : allDesign;
      const done = source.filter(t => t.status === "Done").length;
      const inProgress = source.filter(t => t.status === "In Progress").length;
      const review = source.filter(t => t.status === "Review").length;
      const todo = source.filter(t => t.status === "To Do").length;
      const est = source.reduce((sum, t) => sum + (Number(t.estimateHours) || 0), 0);
      const act = source.reduce((sum, t) => sum + (Number(t.actualHours) || 0), 0);
      return { allDesign, source, done, inProgress, review, todo, est, act };
    }

    function buildWAReport() {
      const d = collectDesignData();
      const now = new Date().toLocaleString("id-ID", {
        day: "2-digit",
        month: "long",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });

      const lines = [
        "*Report Graphic Design*",
        `Waktu: ${now}`,
        `Dataset: ${refs.doneOnlyReport.checked ? "Done only" : "All status"}`,
        `Total tugas desain: ${d.source.length}`,
        `Status: Done ${d.done} | In Progress ${d.inProgress} | Review ${d.review} | To Do ${d.todo}`,
        `Jam: Est ${d.est.toFixed(1)} | Akt ${d.act.toFixed(1)}`,
        "",
        "*Rincian:*"
      ];

      if (!d.source.length) {
        lines.push("- Tidak ada data tugas desain.");
      } else {
        const sorted = [...d.source].sort((a, b) => {
          const sa = STATUS_ORDER.indexOf(a.status);
          const sb = STATUS_ORDER.indexOf(b.status);
          if (sa !== sb) return sa - sb;
          const da = a.dueDate ? new Date(a.dueDate).getTime() : Infinity;
          const db = b.dueDate ? new Date(b.dueDate).getTime() : Infinity;
          return da - db;
        });
        sorted.forEach((task, i) => {
          lines.push(`${i + 1}. [${task.status}] ${task.title} | DL ${formatDate(task.dueDate)} | Est ${Number(task.estimateHours || 0).toFixed(1)}h | Akt ${Number(task.actualHours || 0).toFixed(1)}h`);
        });
      }
      return lines.join("\n");
    }

    function updateWASection() {
      const d = collectDesignData();
      const unlocked = d.allDesign.length >= DESIGN_REPORT_THRESHOLD;
      const remaining = Math.max(0, DESIGN_REPORT_THRESHOLD - d.allDesign.length);

      refs.reportMeta.textContent = `Tugas desain: ${d.allDesign.length}/${DESIGN_REPORT_THRESHOLD}.`;
      refs.waPreview.textContent = buildWAReport();
      refs.copyWaReport.disabled = !unlocked;
      refs.openWaReport.disabled = !unlocked;
      refs.waStatus.textContent = unlocked
        ? "Report aktif. Gunakan Salin/Kirim ke WA untuk membuat laporan harian."
        : `Tambah ${remaining} tugas desain lagi untuk aktifkan fitur report WA.`;
    }

    function rerender() {
      const filtered = getFilteredTasks();
      renderTable(filtered);
      renderKanban(filtered);
      updateKPIsAndInsights();
      updateWASection();
      renderInstagramTimeline();
    }

    function setView(view) {
      activeView = view;
      const isTable = view === "table";
      refs.tableView.classList.toggle("hidden", !isTable);
      refs.kanbanView.classList.toggle("hidden", isTable);
      refs.tableBtn.classList.toggle("active", isTable);
      refs.kanbanBtn.classList.toggle("active", !isTable);
      refs.activeViewText.textContent = isTable ? "Table View" : "Kanban View";
    }

    function nextStatus(current) {
      const i = STATUS_ORDER.indexOf(current);
      if (i < 0 || i >= STATUS_ORDER.length - 1) return STATUS_ORDER[0];
      return STATUS_ORDER[i + 1];
    }

    async function copyText(text) {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return;
      }
      const t = document.createElement("textarea");
      t.value = text;
      t.style.position = "fixed";
      t.style.left = "-9999px";
      document.body.appendChild(t);
      t.focus();
      t.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(t);
      if (!ok) throw new Error("copy_failed");
    }

    function createButtonRipple(event, target) {
      const rect = target.getBoundingClientRect();
      const ripple = document.createElement("span");
      ripple.className = "btn-ripple";
      ripple.style.left = `${event.clientX - rect.left}px`;
      ripple.style.top = `${event.clientY - rect.top}px`;
      target.appendChild(ripple);
      ripple.addEventListener("animationend", function () {
        ripple.remove();
      });
    }

    function downloadJson() {
      const blob = new Blob([JSON.stringify(tasks, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const stamp = new Date().toISOString().slice(0, 10);
      const userPart = currentUser ? normalizeEmail(currentUser.email).replace(/[^a-z0-9_.-]/g, "_") : "user";
      a.href = url;
      a.download = `taskflow-backup-${userPart}-${stamp}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function importJsonFile(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function () {
        try {
          const data = JSON.parse(String(reader.result || "[]"));
          if (!Array.isArray(data)) throw new Error("invalid");
          tasks = data.map(normalizeTask);
          saveTasks();
          rerender();
          alert("Import berhasil.");
        } catch (_) {
          alert("File JSON tidak valid.");
        }
      };
      reader.readAsText(file);
    }

    refs.showLoginTab.addEventListener("click", function () {
      switchAuthTab("login");
    });

    refs.showSignupTab.addEventListener("click", function () {
      switchAuthTab("signup");
    });

    refs.loginForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const email = normalizeEmail(refs.loginEmail.value);
      const password = refs.loginPassword.value;
      const users = loadUsers();
      const user = users.find(u => normalizeEmail(u.email) === email);
      const passHash = hashPassword(password);

      if (!user || user.passwordHash !== passHash) {
        animateAuthForm(refs.loginForm, "shake");
        setAuthMessage("Email atau password salah.", "error");
        return;
      }

      refs.loginForm.reset();
      setAuthMessage("");
      startSession(user);
    });

    refs.signupForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const name = String(refs.signupName.value || "").trim();
      const email = normalizeEmail(refs.signupEmail.value);
      const password = refs.signupPassword.value;
      const confirmPassword = refs.signupPasswordConfirm.value;

      if (!name || !email || !password) {
        animateAuthForm(refs.signupForm, "shake");
        setAuthMessage("Semua field wajib diisi.", "error");
        return;
      }
      if (password.length < 6) {
        animateAuthForm(refs.signupForm, "shake");
        setAuthMessage("Password minimal 6 karakter.", "error");
        return;
      }
      if (password !== confirmPassword) {
        animateAuthForm(refs.signupForm, "shake");
        setAuthMessage("Konfirmasi password tidak sama.", "error");
        return;
      }

      const users = loadUsers();
      const exists = users.some(u => normalizeEmail(u.email) === email);
      if (exists) {
        animateAuthForm(refs.signupForm, "shake");
        setAuthMessage("Email sudah terdaftar.", "error");
        return;
      }

      const newUser = {
        id: crypto.randomUUID(),
        name,
        email,
        passwordHash: hashPassword(password),
        createdAt: new Date().toISOString()
      };

      users.push(newUser);
      saveUsers(users);
      refs.signupForm.reset();
      switchAuthTab("login");
      refs.loginEmail.value = email;
      setAuthMessage("Akun berhasil dibuat. Silakan login.", "success");
      animateAuthForm(refs.loginForm, "reveal");
    });

    refs.profileForm.addEventListener("submit", function (e) {
      e.preventDefault();
      saveCurrentProfile(true);
    });

    [refs.profileName, refs.profileRole].forEach(el => {
      el.addEventListener("input", function () {
        renderProfileHeader({
          name: refs.profileName.value || (currentUser ? currentUser.name : ""),
          role: refs.profileRole.value || ""
        });
      });
    });

    refs.logoutBtn.addEventListener("click", logout);

    refs.igForm.addEventListener("submit", function (e) {
      e.preventDefault();
      if (!currentUser) return;

      const reach = Number(refs.igReach.value || 0);
      if (reach <= 0) {
        refs.igInsights.textContent = "Reach harus lebih besar dari 0.";
        return;
      }

      const post = normalizeIGPost({
        id: crypto.randomUUID(),
        date: refs.igDate.value,
        time: refs.igTime.value,
        contentType: refs.igContentType.value,
        reach,
        likes: Number(refs.igLikes.value || 0),
        comments: Number(refs.igComments.value || 0),
        shares: Number(refs.igShares.value || 0),
        saves: Number(refs.igSaves.value || 0),
        createdAt: new Date().toISOString()
      });

      igPosts.push(post);
      saveIGPosts();
      renderInstagramTimeline();

      const er = computeIGEngagementRate(post);
      refs.igInsights.textContent = `Data posting ditambahkan. ER konten terbaru: ${er.toFixed(2)}%.`;
      refs.igLikes.value = "0";
      refs.igComments.value = "0";
      refs.igShares.value = "0";
      refs.igSaves.value = "0";
    });

    refs.seedIgData.addEventListener("click", function () {
      if (!currentUser) return;
      const dayMs = 86400000;
      const toDate = daysAgo => new Date(Date.now() - (daysAgo * dayMs)).toISOString().slice(0, 10);

      igPosts = [
        { date: toDate(1), time: "19:00", contentType: "Reels", reach: 5600, likes: 730, comments: 65, shares: 140, saves: 210 },
        { date: toDate(2), time: "12:00", contentType: "Carousel", reach: 4200, likes: 410, comments: 34, shares: 70, saves: 95 },
        { date: toDate(3), time: "20:00", contentType: "Reels", reach: 6100, likes: 805, comments: 82, shares: 160, saves: 240 },
        { date: toDate(4), time: "11:30", contentType: "Single Image", reach: 3500, likes: 300, comments: 28, shares: 40, saves: 60 },
        { date: toDate(5), time: "18:30", contentType: "Carousel", reach: 3900, likes: 360, comments: 31, shares: 56, saves: 76 },
        { date: toDate(6), time: "09:30", contentType: "Story", reach: 2700, likes: 190, comments: 18, shares: 24, saves: 22 },
        { date: toDate(7), time: "19:30", contentType: "Reels", reach: 6400, likes: 860, comments: 90, shares: 185, saves: 260 },
        { date: toDate(8), time: "12:00", contentType: "Carousel", reach: 4100, likes: 395, comments: 35, shares: 68, saves: 90 },
        { date: toDate(9), time: "19:00", contentType: "Reels", reach: 5900, likes: 790, comments: 77, shares: 166, saves: 225 },
        { date: toDate(10), time: "10:00", contentType: "Single Image", reach: 3000, likes: 250, comments: 20, shares: 28, saves: 40 }
      ].map(item => normalizeIGPost({ ...item, id: crypto.randomUUID(), createdAt: new Date().toISOString() }));

      saveIGPosts();
      renderInstagramTimeline();
      refs.igInsights.textContent = "Demo data IG berhasil dimuat. Timeline ideal sudah diperbarui.";
    });

    refs.clearIgData.addEventListener("click", function () {
      if (!currentUser) return;
      if (!confirm("Hapus semua data performa posting Instagram?")) return;
      igPosts = [];
      saveIGPosts();
      renderInstagramTimeline();
      refs.igInsights.textContent = "Data IG berhasil direset.";
    });

    refs.title.addEventListener("input", function () {
      const text = refs.title.value;
      if (hasDesignKeyword(text)) {
        refs.type.value = "Graphic Design";
      } else if (hasWebsiteKeyword(text)) {
        refs.type.value = "Web Development";
      }
    });

    refs.taskForm.addEventListener("submit", function (e) {
      e.preventDefault();
      if (!currentUser) return;
      const task = normalizeTask({
        id: crypto.randomUUID(),
        title: refs.title.value.trim(),
        type: refs.type.value,
        priority: refs.priority.value,
        status: refs.status.value,
        dueDate: refs.dueDate.value,
        estimateHours: Number(refs.estimateHours.value || 0),
        actualHours: Number(refs.actualHours.value || 0),
        notes: refs.notes.value.trim(),
        createdAt: new Date().toISOString(),
        completedAt: refs.status.value === "Done" ? new Date().toISOString() : ""
      });

      if (!task.title) return;
      tasks.push(task);
      saveTasks();
      rerender();

      refs.taskForm.reset();
      refs.status.value = "To Do";
      refs.priority.value = "Medium";
      refs.estimateHours.value = "1";
      refs.actualHours.value = "0";
    });

    refs.taskBody.addEventListener("click", function (e) {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = btn.dataset.id;
      const act = btn.dataset.act;
      const idx = tasks.findIndex(t => t.id === id);
      if (idx === -1) return;

      if (act === "next") {
        const ns = nextStatus(tasks[idx].status);
        tasks[idx].status = ns;
        if (ns === "Done" && !tasks[idx].completedAt) tasks[idx].completedAt = new Date().toISOString();
        if (ns !== "Done") tasks[idx].completedAt = "";
      } else if (act === "addtime") {
        tasks[idx].actualHours = Number(tasks[idx].actualHours || 0) + 0.5;
      } else if (act === "delete") {
        tasks.splice(idx, 1);
      }

      saveTasks();
      rerender();
    });

    refs.seedDemo.addEventListener("click", function () {
      if (!currentUser) return;
      const plusDays = d => new Date(Date.now() + d * 86400000).toISOString().slice(0, 10);
      tasks = [
        { title: "Integrasi auth JWT + refresh token", type: "Web Development", priority: "High", status: "In Progress", dueDate: plusDays(1), estimateHours: 6, actualHours: 3, notes: "Tambahkan role guard halaman admin" },
        { title: "Optimasi Core Web Vitals landing page", type: "Web Development", priority: "Medium", status: "Review", dueDate: plusDays(2), estimateHours: 4, actualHours: 4, notes: "Target LCP < 2.5s" },
        { title: "Fix validasi checkout multi-step", type: "Web Development", priority: "High", status: "To Do", dueDate: plusDays(0), estimateHours: 3, actualHours: 0.5, notes: "Perbaiki edge case field kosong" },
        { title: "Desain konten carousel edukasi", type: "Graphic Design", priority: "Medium", status: "Done", dueDate: plusDays(-1), estimateHours: 2.5, actualHours: 2.2, notes: "10 slide + cover" },
        { title: "Revisi logo campaign Q2", type: "Graphic Design", priority: "High", status: "Review", dueDate: plusDays(3), estimateHours: 3, actualHours: 2.4, notes: "2 opsi warna sekunder" },
        { title: "Template feed promo paket bundle", type: "Graphic Design", priority: "Medium", status: "In Progress", dueDate: plusDays(2), estimateHours: 3, actualHours: 1.2, notes: "Format 1080x1080" },
        { title: "Desain thumbnail studi kasus", type: "Graphic Design", priority: "Low", status: "To Do", dueDate: plusDays(4), estimateHours: 1.5, actualHours: 0, notes: "Untuk Behance project page" },
        { title: "Motion teaser produk baru", type: "Graphic Design", priority: "High", status: "Done", dueDate: plusDays(1), estimateHours: 5, actualHours: 4.2, notes: "Durasi 15 detik, format reels" }
      ].map(item => normalizeTask({
        ...item,
        id: crypto.randomUUID(),
        createdAt: new Date().toISOString(),
        completedAt: item.status === "Done" ? new Date().toISOString() : ""
      }));

      saveTasks();
      rerender();
    });

    refs.copyWaReport.addEventListener("click", async function () {
      try {
        await copyText(buildWAReport());
        refs.waStatus.textContent = "Laporan tersalin. Tempel langsung ke chat WhatsApp.";
      } catch (_) {
        refs.waStatus.textContent = "Gagal menyalin otomatis. Silakan copy manual dari preview.";
      }
    });

    refs.openWaReport.addEventListener("click", function () {
      const url = "https://wa.me/?text=" + encodeURIComponent(buildWAReport());
      window.open(url, "_blank");
    });

    refs.doneOnlyReport.addEventListener("change", updateWASection);
    refs.exportJson.addEventListener("click", downloadJson);
    refs.importJson.addEventListener("click", function () { refs.importFile.click(); });
    refs.importFile.addEventListener("change", function (e) { importJsonFile(e.target.files[0]); e.target.value = ""; });
    refs.clearAll.addEventListener("click", function () {
      if (!confirm("Hapus semua tugas?")) return;
      tasks = [];
      saveTasks();
      rerender();
    });

    [refs.searchInput, refs.filterType, refs.filterStatus, refs.filterPriority].forEach(el => {
      el.addEventListener("input", rerender);
      el.addEventListener("change", rerender);
    });

    document.addEventListener("pointerdown", function (e) {
      const target = e.target.closest(".btn, .mini, .auth-tab, .view-switch button, .chip-logout");
      if (!target) return;
      createButtonRipple(e, target);
    });

    refs.tableBtn.addEventListener("click", function () { setView("table"); });
    refs.kanbanBtn.addEventListener("click", function () { setView("kanban"); });

    setInterval(function () {
      updateClock();
      updateInstagramRealtimeStatus();
    }, 1000);
    updateClock();
    updateInstagramRealtimeStatus();
    setView("table");
    switchAuthTab("login");
    if (!restoreSession()) {
      refs.authApp.classList.remove("hidden");
      refs.dashboardApp.classList.add("hidden");
      setAuthMessage("Silakan login atau buat akun karyawan terlebih dahulu.");
    }
  </script>
</body>
</html>
